name: Release Charts

on:
    push:
        branches:
            - main
        paths:
            - charts/**
    pull_request:
        branches:
            - main
        paths:
            - charts/**

jobs:
    release:
        permissions:
            contents: write
            pages: write
            id-token: write
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0
            - name: Configure Git
              run: |
                  git config user.name "$GITHUB_ACTOR"
                  git config user.email "$GITHUB_ACTOR@users.noreply.github.com"
            - name: Install Helm
              uses: azure/setup-helm@v3
              with:
                  version: v3.8.0
            - name: Run Chart Releaser
              uses: helm/chart-releaser-action@v1.7.0
              with:
                  charts_dir: charts
              env:
                  CR_TOKEN: "${{ secrets.GITHUB_TOKEN }}" 